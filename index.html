<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙÙŠØ¯ÙŠÙˆ ØªÙØ§Ø¹Ù„ÙŠ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f0f4f8; }
  #questionDiv { display: none; margin-top: 20px; }
  .option-btn {
    display: block;
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 15px;
    margin: 10px auto;
    font-size: 16px;
    border-radius: 10px;
    width: 60%;
    cursor: pointer;
    transition: 0.3s;
  }
  .option-btn:hover { background-color: #45a049; }
  input[type=text] { padding: 10px; width: 60%; margin: 10px auto; border-radius: 5px; border: 1px solid #ccc; }
  button.submit { padding: 10px 20px; font-size: 16px; border-radius: 8px; cursor: pointer; background-color: #2196F3; color: white; border: none; }
  button.submit:hover { background-color: #0b7dda; }
</style>
</head>
<body>

<h1>Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ ğŸŸ</h1>
<div id="player"></div>

<div id="questionDiv">
  <p id="questionText"></p>
  <div id="optionsDiv"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDEyyB2fqdmDZfz-Lx-Sqp14rTRjpzgDs8",
  authDomain: "school-e4923.firebaseapp.com",
  databaseURL: "https://school-e4923-default-rtdb.firebaseio.com",
  projectId: "school-e4923",
  storageBucket: "school-e4923.firebasestorage.app",
  messagingSenderId: "61066228437",
  appId: "1:61066228437:web:e19b4f85dba29e91c7285c",
  measurementId: "G-MXCB9HVLGN"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let player;
let currentQuestionIndex = 0;
let studentName = "";
let studentAnswers = {};
let studentID = "";

// Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
const questions = [
  { time: 74, text: " ÙƒÙ… ÙŠØ²Ù† Ø§Ù„Ø­ÙˆØª Ø§Ù„Ø£Ø²Ø±Ù‚ØŸ", options: ["180 ÙƒÙŠÙ„Ùˆ","180 Ø·Ù†","200 ÙƒÙŠÙ„Ùˆ","200 Ø·Ù†"], id: "1" },
  { time: 97, text: " Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ù‡ÙŠ ÙÙ‚Ø±ÙŠØ§Øª ÙˆØªÙ…ØªÙ„Ùƒ Ø¹Ù…ÙˆØ¯Ù‹Ø§ ÙÙ‚Ø±ÙŠÙ‹Ø§ ÙˆØ¬Ù…Ø¬Ù…Ø©ØŸ ØµØ­ Ø£Ù… Ø®Ø·Ø£", options: ["ØµØ­","Ø®Ø·Ø£"], id: "2" },
  { time: 125, text: " "Ø§Ø´Ø±Ø­/ÙŠ Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨ÙƒÙ„Ù…Ø§ØªÙƒ: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ù…Ù† Ø°ÙˆØ§Øª Ø§Ù„Ø¯Ù… Ø§Ù„Ø¨Ø§Ø±Ø¯"', options: [], id: "3" },
  { time: 136, text: "Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø°ÙŠÙ„ Ø§Ù„Ø³Ù…ÙƒØ© ÙˆØ§Ù„Ø²Ø¹Ø§Ù†Ù Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©ØŸ", options: ["Ø§Ù„Ø­Ø±ÙƒØ©","Ø§Ù„ØªÙˆØ§Ø²Ù†","Ø§Ù„ØªÙ†ÙØ³"], id: "4" },
  { time: 149, text: " Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø²Ø¹Ø§Ù†Ù Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙˆØ§Ù„Ø³ÙÙ„ÙŠØ©ØŸ", options: ["Ø§Ù„ØªÙˆØ§Ø²Ù† ÙˆØ§Ù„Ø¨Ù‚Ø§Ø¡ Ù…Ø³ØªÙ‚ÙŠÙ…Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø¨Ø§Ø­Ø©","Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø³Ù… Ù…Ù† Ø§Ù„Ù…ÙØªØ±Ø³Ø§Øª","ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„ØºØ°Ø§Ø¡","Ø§Ù„ØªÙ†ÙØ³ ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡"], id: "5" },
  { time: 170, text: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø´ÙˆØ± Ø£Ùˆ Ø§Ù„Ø­Ø±Ø§Ø´Ù Ù‡ÙŠ Ø®Ø´Ù†Ø©ØŸ ØµØ­ Ø£Ù… Ø®Ø·Ø£", options: ["ØµØ­","Ø®Ø·Ø£"], id: "6" },
  { time: 219, text: " ÙƒÙŠÙ ØªØªÙ†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§ÙƒØŸ", options: [], id: "7" },
  { time: 248, text: "Ù…Ø§Ø°Ø§ ØªØ³Ù…Ù‰ Ø§Ù„Ø³Ù…ÙƒØ© Ø¨Ø¹Ø¯ Ø§Ù„ÙÙ‚Ø³ØŸ", options: ["Ø§Ù„ÙŠØ±Ù‚Ø©","Ø§Ù„Ø²Ø¹Ù†ÙØ©","Ø§Ù„Ø¨ÙŠØ¶Ø©","Ø§Ù„ÙŠØ±Ø¨ÙˆØ¹"], id: "8" },
  { time: 255, text: "ÙƒÙŠÙ ØªØ­Ù…ÙŠ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ù†ÙØ³Ù‡Ø§ØŸ Ø£Ø°ÙƒØ± Ø«Ù„Ø§Ø«Ø© Ø·Ø±Ù‚ Ù„Ø°Ù„ÙƒØŸ", options: [], id: "9" },
  { time: 287, text: "ÙƒÙŠÙ ØªØªÙƒØ§Ø«Ø± Ø§Ù„Ø£Ø³Ù…Ø§ÙƒØŸ", options: [], id: "10" }
];

// YouTube player
function onYouTubeIframeAPIReady() {
  studentName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·:");
  // Ø§Ù†Ø´Ø§Ø¡ ID ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨
  studentID = Date.now() + "_" + studentName.replace(/\s+/g, "_");
  
  player = new YT.Player('player', {
    height: '390',
    width: '640',
    videoId: 'Rs3Dt-jwM3w',
    playerVars: { 'start': 41, 'rel': 0, 'enablejsapi': 1 },
    events: { 'onStateChange': onPlayerStateChange }
  });
}

// ØªØ­Ù‚Ù‚ Ø§Ù„ÙˆÙ‚Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
function onPlayerStateChange(event) {
  if(event.data == YT.PlayerState.PLAYING) {
    const checkTime = setInterval(() => {
      if(currentQuestionIndex < questions.length) {
        const q = questions[currentQuestionIndex];
        if(player.getCurrentTime() >= q.time) {
          player.pauseVideo();
          showQuestion(q);
          clearInterval(checkTime);
        }
      } else clearInterval(checkTime);
    }, 500);
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
function showQuestion(q) {
  const qDiv = document.getElementById('questionDiv');
  const qText = document.getElementById('questionText');
  const optionsDiv = document.getElementById('optionsDiv');

  qText.innerText = q.text;
  optionsDiv.innerHTML = '';

  if(q.options.length > 0){
    q.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.innerText = opt;
      btn.className = "option-btn";
      btn.onclick = () => sendAnswer(q.id, opt);
      optionsDiv.appendChild(btn);
    });
  } else {
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'textAnswer';
    input.placeholder = 'Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§';
    const submitBtn = document.createElement('button');
    submitBtn.innerText = 'Ø¥Ø±Ø³Ø§Ù„';
    submitBtn.className = 'submit';
    submitBtn.onclick = () => sendAnswer(q.id, document.getElementById('textAnswer').value);
    optionsDiv.appendChild(input);
    optionsDiv.appendChild(submitBtn);
  }

  qDiv.style.display = 'block';
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¥Ù„Ù‰ Firebase
function sendAnswer(questionID, answer) {
  studentAnswers[questionID] = answer;

  // Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆID ÙØ±ÙŠØ¯ ÙÙŠ Firebase
  firebase.database().ref('responses/' + studentID).set({
    name: studentName,
    answers: studentAnswers
  });

  document.getElementById('questionDiv').style.display = 'none';
  currentQuestionIndex++;
  player.playVideo();
}
</script>
</body>
</html>
